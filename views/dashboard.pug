extends layout

block page_config
  - var activePage = 'dashboard'
  - var searchPlaceholder = 'Cari kontrak atau client...'

block content
  .page-header
    h1.page-title Dashboard Workflow Kontrak
    p.page-subtitle Alur kerja berdasarkan role sesuai proses bisnis operational, commercial, finance, dan super admin.

  if success
    .alert.alert-success= success
  if error
    .alert.alert-danger= error

  .grid.grid-cols-3(style='margin-bottom: 1rem;')
    .card
      .card-header
        h3.card-title Total Kontrak
      .card-content
        .stats-value= totalContracts
    .card
      .card-header
        h3.card-title Kontrak Berjalan
      .card-content
        .stats-value= activeContracts
    .card
      .card-header
        h3.card-title Nilai Kontrak
      .card-content
        .stats-value= 'Rp ' + totalContractValue.toLocaleString('id-ID')

  .grid.grid-cols-2
    .card
      .card-header
        h3.card-title Tugas Saya (#{role})
      .card-content
        if todo.length
          .task-list
            each item in todo
              .task-item.task-item-column
                .task-content
                  p.task-title= item.client_name
                  p.task-time Tahap saat ini: #{item.current_stage}
                form(method='post' action=`/contracts/${item.id}/action/${item.action.actionKey}`)
                  button(type='submit')= item.action.label
        else
          p.stats-change Tidak ada aksi yang menunggu role ini.
    .card
      .card-header
        h3.card-title Quick Links
      .card-content
        .task-list
          .task-item
            .task-content
              p.task-title Kontrak Pipeline
              p.task-time Lihat seluruh alur dan posisi kontrak
            a.btn-secondary(href='/contracts') Buka
          if role === 'super_admin'
            .task-item
              .task-content
                p.task-title Manajemen Pengguna
                p.task-time Buat akun untuk Commercial, Operational, atau Finance
              a.btn-secondary(href='#akun-baru') Buka

  if role === 'super_admin'
    .card(style='margin-top: 1rem;' id='akun-baru')
      .card-header
        h3.card-title Buat Akun User
      .card-content
        form(method='post' action='/users/create' style='max-width: 560px;')
          .form-group
            label(for='name') Nama
            input#name(type='text' name='name' required placeholder='Nama user')
          .form-group
            label(for='email') Email
            input#email(type='email' name='email' required placeholder='email@company.com')
          .form-group
            label(for='role') Role
            select#role(name='role' required)
              option(value='commercial') Commercial / Sales
              option(value='ops') Operational Lead
              option(value='finance') Finance
              option(value='super_admin') Super Admin
          .form-group
            label(for='password') Password
            input#password(type='password' name='password' required placeholder='Minimal 8 karakter')
          button(type='submit') Buat Akun
